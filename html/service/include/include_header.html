<div class="head_inner">
  <h1 class="logo"><a href="DBCI010101.html"><span class="hide">DB CI Archive</span></a></h1>
  <button type="button" class="mnav">
    <span class="hide">전체메뉴 열기</span>
    <span id="line1"></span>
    <span id="line2"></span>
    <span id="line3"></span>
  </button>
  <div class="head menu-hide">
    <div class="user">
      <div class="user_wrap">
        <p class="m_user">
          <em>홍길동님</em>
          <span>안녕하세요</span>
        </p>
        <div class="btn_wrap"><a href="./DBCI010201.html" class="logout">로그아웃</a></div>
      </div>
    </div>
    <nav id="gnb" class="gnb">
      <ul class="gnb_grid">
        <li class="gnb_li">
          <a href="DBCI020101.html" id=""><span><em class="en">CI Archive</em> 소개</span></a>
        </li>
        <li class="gnb_li ciGuide view">
          <a href="DBCI030101.html"><span><em class="en">CI</em> 가이드<i class="plus-icon"></i></span></a>
          <div class="sub_menu depth3">
            <div class="sub_menu_tbl en">
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB공통규정</a></h3>
                  <ul class="sub_ul">
                    <li><a href="DBCI030101.html">Basic</a></li>
                  </ul>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB손해보험</a></h3>
                  <ul class="sub_ul">
                    <li><a href="#">Basic</a></li>
                    <li><a href="#">Application</a></li>
                    <li><a href="#">Signage</a></li>
                  </ul>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB생명</a></h3>
                  <ul class="sub_ul">
                    <li><a href="#">Basic</a></li>
                    <li><a href="#">Application</a></li>
                    <li><a href="#">Signage</a></li>
                  </ul>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB금융투자</a></h3>
                  <ul class="sub_ul">
                    <li><a href="#">Basic</a></li>
                    <li><a href="#">Application</a></li>
                    <li><a href="#">Signage</a></li>
                  </ul>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB저축은행</a></h3>
                  <ul class="sub_ul">
                    <li><a href="#">Basic</a></li>
                    <li><a href="#">Application</a></li>
                    <li><a href="#">Signage</a></li>
                  </ul>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB자산운용</a></h3>
                  <ul class="sub_ul">
                    <li><a href="#">Basic</a></li>
                    <li><a href="#">Application</a></li>
                    <li><a href="#">Signage</a></li>
                  </ul>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB캐피탈</a></h3>
                  <ul class="sub_ul">
                    <li><a href="#">Basic</a></li>
                    <li><a href="#">Application</a></li>
                    <li><a href="#">Signage</a></li>
                  </ul>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB하이텍</a></h3>
                  <ul class="sub_ul">
                    <li><a href="#">Basic</a></li>
                    <li><a href="#">Application</a></li>
                    <li><a href="#">Signage</a></li>
                  </ul>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB메탈</a></h3>
                  <ul class="sub_ul">
                    <li><a href="#">Basic</a></li>
                    <li><a href="#">Application</a></li>
                    <li><a href="#">Signage</a></li>
                  </ul>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="#">DB Inc.</a></h3>
                  <ul class="sub_ul">
                    <li><a href="#">Basic</a></li>
                    <li><a href="#">Application</a></li>
                    <li><a href="#">Signage</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </li>
        <li class="gnb_li">
          <a href="DBCI090101.html" id=""><span><em class="en">CI</em> 적용 문의</span></a>
        </li>
        <li class="gnb_li view">
          <a href="DBCI040101.html"><span>상표권 문의<i class="plus-icon"></i></span></a>
          <div class="sub_menu">
            <div class="sub_menu_tbl">
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="DBCI040101.html">상표 사용 관련 문의</a></h3>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="DBCI040201.html">신규 상표 출원 문의</a></h3>
                </div>
              </div>
            </div>
          </div>
        </li>
        <li class="gnb_li">
          <a href="DBCI050101.html" id=""><span>상표권침해신고</span></a>
        </li>
        <li class="gnb_li view">
          <a href="DBCI060101.html"><span>게시판<i class="plus-icon"></i></span></a>
          <div class="sub_menu">
            <div class="sub_menu_tbl">
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="DBCI060101.html">공지사항</a></h3>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="DBCI060201.html">CI 활용사례</a></h3>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="DBCI060301.html">자료실</a></h3>
                </div>
              </div>
            </div>
          </div>
        </li>
        <li class="gnb_li view">
          <a href="DBCI070101.html"><span><em class="en">My Page</em><i class="plus-icon"></i></span></a>
          <div class="sub_menu depth3">
            <div class="sub_menu_tbl">
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="DBCI070101.html" class="en">My Page</a></h3>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="DBCI070201.html">나의 문의내역</a></h3>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="DBCI070301.html">나의 신고내역</a></h3>
                </div>
              </div>
              <div class="cell">
                <div class="sub_menu_list">
                  <h3><a href="DBCI070401.html">회원정보수정</a></h3>
                  <ul class="sub_ul">
                    <li><a href="DBCI070401.html">회원정보수정</a></li>
                    <li><a href="DBCI070403.html">비밀번호변경</a></li>
                    <li><a href="DBCI070405.html">회원탈퇴</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </nav>
  </div>
</div>
<div class="gnb_bg"></div>

<script>
  ;(function(){
    $plugins.GnbNav = {
      header: $('#inc_header'),
      nav: $('#gnb'),
      menu: $('#gnb .gnb_li'),
      menuDepth1: $('#gnb .gnb_li > a'),
      subMenu: $('#gnb .sub_menu'),
      subMenuDepth2: $('#gnb .sub_menu .cell'),
      bg: $('.gnb_bg'),
      navBtn: $('.mnav'), // 전체메뉴 열기 버튼
      navArea: $('.menu-hide'), // 전체메뉴 영역
      menuSpeed: 200,
      bgSpeed: 200,
      openTimeout: '',
      closeTimeout: '',
      activeMenu: null, // 마우스오버로 활성화한 메뉴 뎁스
      evt: null, // pc, mobile 상황에 따른 이벤트 설정
      openFn: function() {
        var o = this;
        o.menu.off().on(o.evt, function() {

          o.activeMenu = $(this);

          if(!o.subMenuDepth2.find('a').is(':focus')) { // 키보드 이용 시, 하위 뎁스에 포커스가 들어갈 경우 아래 코드시 실행되어 반짝거리게 됨. 이를 막기 위한 조건

            var $subMenu = o.activeMenu.find('.sub_menu'),
                $subMenuHeight = $subMenu.height(),
                $subMenuOuterHeight = $subMenu.outerHeight();


            // mobile
            if($('html').hasClass('ui-m')) {
              if($subMenu.length) { // 하위 메뉴 있는 경우
                event.preventDefault();
                if(!o.activeMenu.hasClass('active')) {
                    // event.preventDefault();
                  o.activeMenu.addClass('active');
                } else {
                  o.activeMenu.removeClass('active');
                }
                $subMenu.slideToggle();

              } else { // 하위 메뉴 없는 경우
                o.resetFn();
              }

              o.header.addClass('show');

            }
            // pc
            else {
              // 초기화
              o.resetFn();

              // 초기화 이후 해당 메뉴 설정
              if($subMenu.length) { // 하위 메뉴 있는 경우
                $subMenu.fadeIn(100);
                o.bg.height($subMenuOuterHeight);
              } else {// 하위 메뉴 없는 경우
                o.resetFn();
              }

              o.activeMenu.addClass('active');
              o.header.addClass('show');

              // 영역 밖으로 마우스 나갔을 경우 초기화
              o.closeMouseFn();

              // 영역 밖으로 키보드로 나갔을 경우 초기화
              o.closeKeyFn();

            }
          }
        });
      },
      resetFn: function() {
        var o = this;
          o.menu.removeClass('active');
          o.subMenu.hide();
          o.bg.height(0);
          o.header.removeClass('show');
      },
      closeMouseFn: function() {
        var o = this;
        o.menu.off('mouseleave.nameClose').on('mouseleave.nameClose', function() {
          o.resetFn();
        });
      },
      closeKeyFn: function() {
        var o = this;

        $('body').find('a').off('focus.keyboard').on('focus.keyboard', function() {
          var cIdx = $('body').find('a').index(this)
              firstEle = $('body').find('a').index(o.menu.find('a').eq(0)),
              lastEle = $('body').find('a').index(o.menu.find('a').eq(o.menu.find('a').length-1));

          if( cIdx < firstEle || cIdx > lastEle) {
            o.resetFn();
          }
        })
      },
      navActiveFn: function() {
        var o = this;
        o.navArea.attr('aria-hidden','true');

        var activeFn = function() {
            o.navBtn.addClass('active');
            o.navArea.addClass('open');
            o.navBtn.find('.hide').text('전체메뉴 닫기');
            o.navArea.attr('aria-hidden','false');
        }
        var inActiveFn = function() {
            o.navBtn.removeClass('active');
            o.navArea.removeClass('open');
            o.navBtn.find('.hide').text('전체메뉴 열기');
            o.navArea.attr('aria-hidden','true');
        }

        o.navBtn.off().on(o.evt, function() {
          if(!o.navBtn.hasClass('active')) {
            activeFn();
          } else {
            inActiveFn();
          }

        });
      },
      init: function() {
        var o = this;

        $('html').hasClass('ui-d') ? o.evt = 'mouseenter focusin' : o.evt = 'click';

        // 모바일일 경우 전체메뉴 열기/닫기 event
        if($('html').hasClass('ui-m')) {
          o.navActiveFn();
        }

        // 1depth event
        o.openFn();


      }
    }

    $(document).ready(function() {
      $plugins.GnbNav.init();
    });

  })();
</script>
